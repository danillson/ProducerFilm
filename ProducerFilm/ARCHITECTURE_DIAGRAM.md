# Arquitetura DDD - ProducerFilm

## Diagrama de Camadas

```
????????????????????????????????????????????????????????????????
?                    PRESENTATION LAYER                         ?
?  ??????????????????????????????????????????????????????????  ?
?  ?           MoviesController.cs                          ?  ?
?  ?  - GetAllMovies()                                      ?  ?
?  ?  - GetMovieById(id)                                    ?  ?
?  ?  - GetWinnerInterval()                                 ?  ?
?  ?  - CreateMovie(dto)                                    ?  ?
?  ??????????????????????????????????????????????????????????  ?
????????????????????????????????????????????????????????????????
                            ? ?
????????????????????????????????????????????????????????????????
?                   APPLICATION LAYER                           ?
?  ??????????????????????????????????????????????????????????  ?
?  ?      IMovieListHistoryService (Interface)             ?  ?
?  ?  ???????????????????????????????????????????????????? ?  ?
?  ?  ?   MovieListHistoryService (Implementation)       ? ?  ?
?  ?  ?  - GetAllMoviesAsync()                          ? ?  ?
?  ?  ?  - GetWinnerIntervalsAsync()                    ? ?  ?
?  ?  ?  - CreateMovieAsync(dto)                        ? ?  ?
?  ?  ???????????????????????????????????????????????????? ?  ?
?  ??????????????????????????????????????????????????????????  ?
?                                                                ?
?  ??????????????????????????????????????????????????????????  ?
?  ?                    DTOs                                 ?  ?
?  ?  - MovieListHistoryDto                                 ?  ?
?  ?  - CreateMovieListHistoryDto                           ?  ?
?  ?  - WinnerIntervalResponseDto                           ?  ?
?  ??????????????????????????????????????????????????????????  ?
????????????????????????????????????????????????????????????????
                            ? ?
????????????????????????????????????????????????????????????????
?                      DOMAIN LAYER                             ?
?  ??????????????????????????????????????????????????????????  ?
?  ?                    Entities                             ?  ?
?  ?  ????????????????????????????????????????????????????  ?  ?
?  ?  ?       MovieListHistory                           ?  ?  ?
?  ?  ?  - Id, Year, Title, Producers, Winner          ?  ?  ?
?  ?  ?  + IsWinner(): bool                             ?  ?  ?
?  ?  ?  + GetProducersList(): IEnumerable<string>     ?  ?  ?
?  ?  ?  + Update(...)                                  ?  ?  ?
?  ?  ????????????????????????????????????????????????????  ?  ?
?  ??????????????????????????????????????????????????????????  ?
?                                                                ?
?  ??????????????????????????????????????????????????????????  ?
?  ?                 Value Objects                           ?  ?
?  ?  - ProducerInterval                                     ?  ?
?  ?  - WinnerIntervalResult                                 ?  ?
?  ??????????????????????????????????????????????????????????  ?
?                                                                ?
?  ??????????????????????????????????????????????????????????  ?
?  ?              Domain Services                            ?  ?
?  ?  ????????????????????????????????????????????????????  ?  ?
?  ?  ?    WinnerIntervalDomainService                   ?  ?  ?
?  ?  ?  + CalculateWinnerIntervals(...)                ?  ?  ?
?  ?  ????????????????????????????????????????????????????  ?  ?
?  ??????????????????????????????????????????????????????????  ?
?                                                                ?
?  ??????????????????????????????????????????????????????????  ?
?  ?                   Interfaces                            ?  ?
?  ?  - IMovieListHistoryRepository                          ?  ?
?  ??????????????????????????????????????????????????????????  ?
????????????????????????????????????????????????????????????????
                            ? ?
????????????????????????????????????????????????????????????????
?                 INFRASTRUCTURE LAYER                          ?
?  ??????????????????????????????????????????????????????????  ?
?  ?                  Repositories                           ?  ?
?  ?  ????????????????????????????????????????????????????  ?  ?
?  ?  ?   MovieListHistoryRepository                     ?  ?  ?
?  ?  ?  - GetAllAsync()                                 ?  ?  ?
?  ?  ?  - GetByIdAsync(id)                              ?  ?  ?
?  ?  ?  - AddAsync(entity)                              ?  ?  ?
?  ?  ?  - UpdateAsync(entity)                           ?  ?  ?
?  ?  ????????????????????????????????????????????????????  ?  ?
?  ??????????????????????????????????????????????????????????  ?
?                                                                ?
?  ??????????????????????????????????????????????????????????  ?
?  ?                  Data Context                           ?  ?
?  ?  ????????????????????????????????????????????????????  ?  ?
?  ?  ?            AppDbContext                          ?  ?  ?
?  ?  ?  - DbSet<MovieListHistory>                       ?  ?  ?
?  ?  ?  - OnModelCreating(...)                          ?  ?  ?
?  ?  ????????????????????????????????????????????????????  ?  ?
?  ??????????????????????????????????????????????????????????  ?
?                                                                ?
?  ??????????????????????????????????????????????????????????  ?
?  ?              Infrastructure Services                    ?  ?
?  ?  - CsvFileProcessorService                              ?  ?
?  ??????????????????????????????????????????????????????????  ?
????????????????????????????????????????????????????????????????
                            ? ?
????????????????????????????????????????????????????????????????
?                     SQLite Database                           ?
?              producerfilm.db                                  ?
????????????????????????????????????????????????????????????????
```

## Fluxo de Requisição Completo

```
1. HTTP Request
   GET /api/movies/winner-interval
        ?
2. [Presentation] MoviesController
   - Recebe requisição
   - Valida entrada
        ?
3. [Application] MovieListHistoryService
   - Chama GetWinnerIntervalsAsync()
   - Obtém winners do repositório
        ?
4. [Infrastructure] MovieListHistoryRepository
   - GetWinnersAsync()
   - Query no banco de dados
        ?
5. [Domain] WinnerIntervalDomainService
   - CalculateWinnerIntervals()
   - Aplica regras de negócio
   - Usa métodos da entidade MovieListHistory
        ?
6. [Domain] MovieListHistory Entity
   - IsWinner()
   - GetProducersList()
        ?
7. [Domain] Value Objects
   - Cria ProducerInterval
   - Cria WinnerIntervalResult
        ?
8. [Application] MovieListHistoryService
   - Converte para WinnerIntervalResponseDto
        ?
9. [Presentation] MoviesController
   - Retorna HTTP 200 OK
   - JSON Response
```

## Dependências entre Camadas

```
                    ???????????????????
                    ?   Presentation  ?
                    ???????????????????
                             ?
                    ???????????????????
                    ?   Application   ?
                    ???????????????????
                             ?
                    ???????????????????
                    ?     Domain      ? ???? NÚCLEO (Independente)
                    ???????????????????
                             ?
                    ???????????????????
                    ? Infrastructure  ?
                    ???????????????????

Regra: Dependências sempre apontam para DENTRO (Domain)
Domain não conhece Application, Infrastructure ou Presentation
```

## Princípios SOLID Aplicados

### 1. Single Responsibility (SRP)
```
MoviesController        ? Apenas lida com HTTP
MovieListHistoryService ? Apenas orquestra casos de uso
MovieListHistory        ? Apenas regras de negócio de filme
Repository              ? Apenas persistência
```

### 2. Open/Closed (OCP)
```
IMovieListHistoryRepository (Interface)
  ?
  ??? MovieListHistoryRepository (EF Core)
  ??? InMemoryRepository (Testes)
  ??? MongoDbRepository (Futuro)
```

### 3. Liskov Substitution (LSP)
```
Qualquer implementação de IMovieListHistoryRepository
pode substituir outra sem quebrar o código
```

### 4. Interface Segregation (ISP)
```
Interfaces específicas por responsabilidade:
- IMovieListHistoryRepository
- IMovieListHistoryService
```

### 5. Dependency Inversion (DIP)
```
Application depende de ? IMovieListHistoryRepository (abstração)
Infrastructure implementa ? MovieListHistoryRepository (concreto)
```

---

**Arquitetura modular, testável e manutenível** ??
